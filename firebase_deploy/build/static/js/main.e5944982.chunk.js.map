{"version":3,"sources":["../node_modules/peerjs/dist sync","video.js","App.js","reportWebVitals.js","index.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","Cus_video","stream","domvideo","useRef","useEffect","current","srcObject","ref","width","autoPlay","display","theme","createMuiTheme","typography","fontFamily","join","_peer","Peer","initiator","trickle","secure","App","useState","peer","setpeer","peerID","setpeerID","conn","setconn","peerConnectID","setpeerConnectID","optional","setoptional","messages","setmessages","clientVideo","objectVideo","setobjectVideo","img","setimg","on","err","alert","console","log","data","send","type","from","undefined","prev","msg","filename","arrayBufferView","Uint8Array","blob","Blob","url","URL","createObjectURL","window","open","success","call","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","mediaDevices","video","innerWidth","height","innerHeight","audio","answer","remoteStream","prevStream","push","pp","filter","ele","ind","findIndex","elem","getTracks","forEach","track","stop","error","back","disconnect","destroy","connectPeer","option","fail","connect","typemsg","settypemsg","file","setmyfile","buttonUpload","setbuttonUpload","Container","maxWidth","Card","CardContent","Tooltip","title","Typography","onClick","clipboard","writeText","CardActions","style","justifyContent","Button","variant","size","justify","Grid","container","p","Item","xs","TextField","label","onChange","target","value","disabled","mt","map","color","defaultValue","onKeyDown","key","myid","message","accept","files","onChangeHandler","fileReader","FileReader","slice","readAsArrayBuffer","onload","evt","arrayBuffer","result","name","onClickHandler","src","muted","i","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e5944982.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 62;","import React,{useRef,useEffect} from 'react';\r\n\r\nconst Cus_video = ({stream}) => {\r\n    const domvideo = useRef()\r\n    useEffect(() => {\r\n        domvideo.current.srcObject = stream\r\n    }, [])\r\n    return (\r\n        <video id={stream.id} ref={domvideo} width=\"50%\" autoPlay display=\"flex\"></video>\r\n    );\r\n}\r\n\r\nexport default Cus_video;\r\n","import React, { useState, useRef, useEffect, createRef } from \"react\";\r\nimport {\r\n  Button,\r\n  Container,\r\n  Typography,\r\n  createMuiTheme,\r\n  CardContent,\r\n  CardActions,\r\n  Card,\r\n  TextField,\r\n  Grid,\r\n  Tooltip,\r\n  IconButton,\r\n  palette,\r\n} from \"@material-ui/core\";\r\nimport { spacing ,positions } from '@material-ui/system';\r\nimport Peer from \"peerjs\";\r\nimport Cus_video from './video'\r\n\r\nconst theme = createMuiTheme({\r\n  typography: {\r\n    fontFamily: [\r\n      \"-apple-system\",\r\n      \"BlinkMacSystemFont\",\r\n      '\"Segoe UI\"',\r\n      \"Roboto\",\r\n      '\"Helvetica Neue\"',\r\n      \"Arial\",\r\n      \"sans-serif\",\r\n      '\"Apple Color Emoji\"',\r\n      '\"Segoe UI Emoji\"',\r\n      '\"Segoe UI Symbol\"',\r\n    ].join(\",\"),\r\n  },\r\n});\r\nconst _peer = new Peer({\r\n  initiator: true,\r\n  trickle: false,\r\n\r\n  secure: true,\r\n});\r\nconst App = () => {\r\n  const [peer, setpeer] = useState(_peer);\r\n  const [peerID, setpeerID] = useState(\"\");\r\n  const [conn, setconn] = useState();\r\n  const [peerConnectID, setpeerConnectID] = useState();\r\n  const [optional, setoptional] = useState();\r\n  const [messages, setmessages] = useState([]);\r\n  const clientVideo = useRef();\r\n  const [objectVideo, setobjectVideo] = useState([]);\r\n  const [img, setimg] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    peer.on(\"open\", (id) => {\r\n      setpeerID(id)\r\n    });\r\n    peer.on(\"error\", (err) => {\r\n      alert(err);\r\n      setconn(null);\r\n      setpeerConnectID(null);\r\n    });\r\n    peer.on(\"connection\", (conn) => {\r\n      setconn(conn);\r\n      console.log(\":N:--->> peer connection\");\r\n      console.log(conn);\r\n      conn.on(\"open\", () => {\r\n        const data = `${peer.id} is Joined`;\r\n        conn.send({ type: \"chat\", data: data, from: peer.id });\r\n      });\r\n      conn.on(\"data\", (data) => {\r\n        if (peerConnectID === undefined) setpeerConnectID(data.from);\r\n        if (data.type === \"chat\") {\r\n          setmessages((prev) => [...prev, { from: data.from, msg: data.data }]);\r\n          setoptional(2);\r\n        } else if (data.type === \"file\") {\r\n          setoptional(3);\r\n          console.log(data);\r\n          if (data.filename) {\r\n            var arrayBufferView = new Uint8Array(data.data);\r\n            const blob = new Blob([arrayBufferView], { type: \"image/jpeg\" });\r\n            const url = URL.createObjectURL(blob);\r\n            console.log(url);\r\n            setimg(url);\r\n            window.open(url, \"_blank\");\r\n            if (url) {\r\n              conn.send({ type: \"connect\", success: true });\r\n            }\r\n          }\r\n        }\r\n        if (data.type === \"connect\" && data.success) {\r\n          console.log(\"success\");\r\n          conn.send({ type: \"connect\", success: true });\r\n        }\r\n      });\r\n\r\n      conn.on(\"error\", (err) => {\r\n        setconn(null);\r\n        setpeerConnectID(null);\r\n      });\r\n    });\r\n\r\n    peer.on(\"disconnect\", () => {\r\n      setconn();\r\n      console.log(\"disconnect\");\r\n    });\r\n\r\n    \r\n    peer.on(\"call\", (call) => {\r\n      let _navigator = navigator.getUserMedia ||\r\n        navigator.webkitGetUserMedia.getUserMedia ||\r\n        navigator.mozGetUserMedia.getUserMedia ||\r\n        navigator.mediaDevices.getUserMedia;\r\n        \r\n        _navigator (\r\n        { video: { width: window.innerWidth / 2, height: window.innerHeight / 2 }, audio: true },\r\n        (stream) => {\r\n          clientVideo.current.srcObject = stream;\r\n          call.answer(stream); // Answer the call with an A/V stream.\r\n          call.on(\"stream\", (remoteStream) => {\r\n            prevStream.push(remoteStream)\r\n            let pp = prevStream.filter( (ele, ind) => ind === prevStream.findIndex( elem =>  elem.id === ele.id))\r\n            setobjectVideo(pp)\r\n            setconn(call);\r\n          });\r\n          call.on(\"error\", (err) => {\r\n            alert(err);\r\n            stream.getTracks().forEach((track) => track.stop());\r\n          });\r\n        },\r\n        (err) => {\r\n          console.error(\"Failed to get local stream\", err);\r\n        }\r\n      );\r\n    });\r\n  }, [peer]);\r\n  let prevStream = []\r\n  const back = () => {\r\n    peer.disconnect()\r\n    peer.destroy();\r\n    const _peer = new Peer(peerID,{\r\n      initiator: true,\r\n      trickle: false,\r\n      secure: true,\r\n    });\r\n    setpeer(_peer)\r\n    setoptional()\r\n    setconn()\r\n    setobjectVideo([])\r\n    prevStream=[]\r\n    clientVideo.current.srcObject = null\r\n  };\r\n  const openWebCam = () => {\r\n    let _navigator = navigator.getUserMedia ||\r\n        navigator.webkitGetUserMedia.getUserMedia ||\r\n        navigator.mozGetUserMedia.getUserMedia ||\r\n        navigator.mediaDevices.getUserMedia;\r\n        \r\n        _navigator (\r\n      { video: { width: window.innerWidth / 2, height: window.innerHeight / 2 }, audio: true },\r\n      (stream) => {\r\n        const call = peer.call(peerConnectID, stream);\r\n        console.log(` caller => `,call,stream)\r\n        clientVideo.current.srcObject = stream;\r\n        call.on(\"stream\", (remoteStream) => {\r\n          prevStream.push(remoteStream)\r\n          let pp = prevStream.filter( (ele, ind) => ind === prevStream.findIndex( elem =>  elem.id === ele.id))\r\n          setobjectVideo(pp)\r\n          setconn(call);\r\n        });\r\n        call.on(\"error\", (err) => {\r\n          alert(err);\r\n          stream.getTracks().forEach((track) => track.stop());\r\n        });\r\n      },\r\n      (fail) => alert(`ไม่สามารถเปิดกล้องได้`)\r\n    );\r\n  };\r\n  const connectPeer = (option) => {\r\n    if (option === 1) {\r\n      openWebCam();\r\n    } else if (option === 2) {\r\n      const conn = peer.connect(peerConnectID);\r\n      console.log(\"<<---:E: peer connection\");\r\n      console.log(conn);\r\n      conn.on(\"open\", () => {\r\n        const data = `${peer.id} is Joined`;\r\n        conn.send({ type: \"chat\", data: data, from: peer.id });\r\n      });\r\n      setconn(conn);\r\n      conn.on(\"data\", (data) => {\r\n        if (peerConnectID === undefined) setpeerConnectID(data.from);\r\n        if (data.type === \"chat\") {\r\n          setmessages((prev) => [...prev, { from: data.from, msg: data.data }]);\r\n          setoptional(2);\r\n        } else if (data.type === \"file\") {\r\n          setoptional(3);\r\n          console.log(data);\r\n          if (data.filename) {\r\n            var arrayBufferView = new Uint8Array(data.data);\r\n            const blob = new Blob([arrayBufferView], { type: \"image/jpeg\" });\r\n            const url = URL.createObjectURL(blob);\r\n            console.log(url);\r\n            setimg(url);\r\n            window.open(url, \"_blank\");\r\n            if (url) {\r\n              conn.send({ type: \"connect\", success: true });\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      conn.on(\"error\", (err) => {\r\n        setconn(null);\r\n        setpeerConnectID(null);\r\n      });\r\n    } else if (option === 3) {\r\n      const conn = peer.connect(peerConnectID);\r\n      console.log(\"<<---:E: peer connection\");\r\n      console.log(conn);\r\n      conn.on(\"open\", () => {\r\n        const data = `${peer.id} is Joined`;\r\n        conn.send({ type: \"file\", data: data, from: peer.id });\r\n      });\r\n      setconn(conn);\r\n      conn.on(\"data\", (data) => {\r\n        if (data.type === \"file\") {\r\n          setmessages((prev) => [...prev, { from: data.from, msg: data.data }]);\r\n        }\r\n      });\r\n\r\n      conn.on(\"error\", (err) => {\r\n        setconn(null);\r\n        setpeerConnectID(null);\r\n      });\r\n      setoptional(3);\r\n    } else {\r\n      alert(\"fail to connect\");\r\n    }\r\n  };\r\n  const [typemsg, settypemsg] = useState(\"\");\r\n\r\n  const chat = () => {\r\n    return (\r\n      <>\r\n        {messages.map((data, ind) => (\r\n          <Grid key={ind + data.from + data.msg} Item xs={12}>\r\n          <CardActions style={{ width: '90%' ,justifyContent: data.from === peer.id ? \"flex-end\" : \"flex-start\" }}>\r\n              <Typography\r\n                color={data.from === peer.id ? \"primary\" : \"textPrimary\"}\r\n              >\r\n                {data.msg}\r\n              </Typography>\r\n            </CardActions>\r\n          </Grid>\r\n        ))}\r\n        <TextField\r\n          type=\"text\"\r\n          label=\"ใส่ข้อความ\"\r\n          defaultValue={typemsg}\r\n          onChange={(e) => settypemsg(e.target.value)}\r\n          onKeyDown={(e) => {\r\n            if (e.key == \"Enter\") {\r\n              const msg = typemsg;\r\n              const myid = peer.id;\r\n              try{\r\n                conn.send({ type: \"chat\", data: msg, from: myid });\r\n              }catch(e){alert(e.message); back()}\r\n              setmessages((prev) => [...prev, { from: myid, msg: typemsg }]);\r\n              e.target.value = \"\";\r\n            }\r\n          }}\r\n        />\r\n      </>\r\n    );\r\n  };\r\n  const [file, setmyfile] = useState();\r\n  const [buttonUpload, setbuttonUpload] = useState(true);\r\n\r\n  const upload = () => {\r\n    const onChangeHandler = (e) => {\r\n      setmyfile(e.target.files[0]);\r\n\r\n      setbuttonUpload(false);\r\n    };\r\n    const onClickHandler = () => {\r\n      const fileReader = new FileReader();\r\n\r\n      const slice = file.slice(0, 10485760);\r\n      fileReader.readAsArrayBuffer(slice);\r\n      fileReader.onload = (evt) => {\r\n        const arrayBuffer = fileReader.result;\r\n        conn.send({\r\n          type: \"file\",\r\n          data: arrayBuffer,\r\n          filename: file.name,\r\n          from: peer.id,\r\n        });\r\n      };\r\n      //\r\n    };\r\n    return (\r\n      <>\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          onChange={(e) => onChangeHandler(e)}\r\n        />\r\n        <Button\r\n          variant=\"outlined\"\r\n          color=\"primary\"\r\n          disabled={buttonUpload}\r\n          onClick={() => onClickHandler()}\r\n        >\r\n          Upload\r\n        </Button>\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {peer ? (\r\n        <>\r\n          <Container theme={theme} maxWidth=\"sm\">\r\n            <Card>\r\n              <CardContent display=\"flex\">\r\n                    <Tooltip title=\"กดเพื่อคัดลอก\">\r\n                      <Typography\r\n                      \r\n                        onClick={() => {\r\n                          try {\r\n                            navigator.clipboard.writeText(peerID);\r\n                          } catch (e) {\r\n                            console.log(\r\n                              \"ERROR : ไม่สามารถใช้งานคลิกเพื่อคัดลอกได้ \\n ให้ผู้ใช้คลุมเพื่อคัดลอกแทน \\n\"\r\n                            );\r\n                          }\r\n                        }}\r\n                      >\r\n                        ID : {peerID}{\" \"}  \r\n                      </Typography>\r\n                    </Tooltip>\r\n\r\n              </CardContent>\r\n              {conn ? (\r\n                <CardActions style={{ width: '90%', justifyContent: 'flex-end'  }}>\r\n                  <Button\r\n                    variant=\"contained\"\r\n                    size=\"small\"\r\n                    justify=\"space-between\" \r\n                    onClick={() => back()}\r\n                  >\r\n                    ย้อนกลับ\r\n                  </Button>\r\n                  </CardActions>\r\n\r\n              ) : (\r\n                <>\r\n                  <hr />\r\n                  <Grid container p=\"2\">\r\n                    <Grid Item xs={10}>\r\n                      <TextField\r\n                        type=\"text\"\r\n                        label=\"ID เพื่อน \"\r\n                        onChange={(e) => setpeerConnectID(e.target.value)}\r\n                      />\r\n                    </Grid>\r\n                    <Grid Item xs={3}>\r\n                      <Button\r\n                        variant=\"contained\"\r\n                        size=\"small\"\r\n                        onClick={() => {\r\n                          console.log('open camera')\r\n                          connectPeer(1);\r\n                        }}\r\n                        disabled={!peerConnectID ? true : false}\r\n                      >\r\n                        กล้อง\r\n                      </Button>\r\n                    </Grid>\r\n                    <Grid Item xs={3}>\r\n                      <Button\r\n                        variant=\"contained\"\r\n                        size=\"small\"\r\n                        onClick={() => connectPeer(2)}\r\n                        disabled={!peerConnectID ? true : false}\r\n                      >\r\n                        แชท\r\n                      </Button>\r\n                    </Grid>\r\n                    <Grid Item xs={3}>\r\n                      <Button\r\n                        variant=\"contained\"\r\n                        size=\"small\"\r\n                        onClick={() => connectPeer(3)}\r\n                        disabled={!peerConnectID ? true : false}\r\n                      >\r\n                        ไฟล์\r\n                      </Button>\r\n                    </Grid>\r\n                  </Grid>\r\n                </>\r\n              )}\r\n            </Card>\r\n          </Container>\r\n          <Container theme={theme} maxWidth=\"sm\" mt={2}>\r\n            <Grid container justify=\"center\">\r\n              {optional === 2 ? (\r\n                <>{chat()}</>\r\n              ) : optional === 3 ? (\r\n                <>{upload()}</>\r\n              ) : (\r\n                <></>\r\n              )}\r\n            </Grid>\r\n          </Container>\r\n\r\n          <Grid container justify=\"center\">\r\n            <image src={img} onClick={() => window.open(img, \"_blank\")} />\r\n            <video\r\n              display=\"flex\"\r\n              ref={clientVideo}\r\n              width=\"50%\"\r\n              autoPlay\r\n              muted\r\n            />\r\n            {objectVideo && objectVideo.map((stream,i)=><Cus_video key={i} stream={stream} />)}\r\n           </Grid>\r\n        </>\r\n      ) : (\r\n        <></>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}