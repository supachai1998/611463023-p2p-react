(this["webpackJsonpreact-simple"]=this["webpackJsonpreact-simple"]||[]).push([[0],{197:function(e,t,n){},204:function(e,t){},206:function(e,t){},216:function(e,t){},218:function(e,t){},245:function(e,t){},246:function(e,t){},251:function(e,t){},253:function(e,t){},260:function(e,t){},279:function(e,t){},298:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=298},312:function(e,t,n){"use strict";n.r(t);var c=n(0),o=n.n(c),a=n(12),i=n.n(a),r=(n(197),n(70)),s=n.n(r),l=n(108),u=n(47),d=n(23),j=n(178),f=n(314),b=n(350),g=n(358),p=n(352),m=n(353),O=n(354),h=n(355),x=n(363),y=n(356),v=n(357),w=n(360),U=n(169),k=n.n(U),F=n(109),S=n.n(F),M=n(3),C=function(e){var t=e.stream,n=Object(c.useRef)();return Object(c.useEffect)((function(){n.current.srcObject=t}),[]),Object(M.jsx)("video",{id:t.id,ref:n,width:"100%",height:"50%",style:{margin:"auto auto"},autoPlay:!0,display:"flex"})},E=n(179),I=n(344),T=n(346),R=n(348),z=n(349),G=n(174),D=n.n(G),L=Object(I.a)((function(e){return{root:{width:"100%",backgroundColor:e.palette.background.paper}}})),_=function(e){return Object(M.jsx)(T.a,Object(E.a)({button:!0,component:"a"},e))},B=function(e){var t=e.file;console.log(t.type,t.type.split("/"));var n=L();return Object(M.jsx)("div",{className:n.root,children:Object(M.jsxs)(_,{href:"#",onClick:function(){return window.open(t.url,"_blank")},children:[Object(M.jsx)(R.a,{children:"image"===t.type.split("/")[0]?Object(M.jsx)("img",{width:30,height:30,src:t.url}):Object(M.jsx)(D.a,{})}),Object(M.jsxs)(z.a,{children:[" ",t.name]})]})})},W=n(359),H=n(82),J=function(e){var t=e.data,n=e.peer;return Object(M.jsx)(T.a,{style:{display:"flex",justifyContent:t.from===n.id?"flex-end":"flex-start"},children:Object(M.jsx)(W.a,{bgcolor:"info",children:Object(M.jsx)(H.a,{nowrap:!0,color:t.from===n.id?"primary":"initial",children:t.msg})})})},N=Object(j.a)({typography:{fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'].join(",")}}),V=function(){var e="-CS61",t=k.a.generate(2),n=Object(c.useState)(new S.a(t+e,{initiator:!0,trickle:!1,secure:!0,port:443,iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]})),o=Object(d.a)(n,2),a=o[0],i=o[1],r=Object(c.useState)(!1),j=Object(d.a)(r,2),U=j[0],F=j[1],E=Object(c.useState)(t),I=Object(d.a)(E,2),T=I[0],R=I[1],z=Object(c.useState)(),G=Object(d.a)(z,2),D=G[0],L=G[1],_=Object(c.useState)(),W=Object(d.a)(_,2),H=W[0],V=W[1],P=Object(c.useState)(""),A=Object(d.a)(P,2),K=A[0],q=A[1],Q=Object(c.useState)(),X=Object(d.a)(Q,2),Y=X[0],Z=X[1],$=Object(c.useState)([]),ee=Object(d.a)($,2),te=ee[0],ne=ee[1],ce=Object(c.useRef)(),oe=Object(c.useState)([]),ae=Object(d.a)(oe,2),ie=ae[0],re=ae[1],se=Object(c.useState)([]),le=Object(d.a)(se,2),ue=le[0],de=le[1],je=Object(c.useState)(!1),fe=Object(d.a)(je,2),be=fe[0],ge=fe[1];Object(c.useEffect)((function(){a.on("open",(function(e){console.log("connect server peerid : ",e),F(!0)})),a.on("error",(function(e){F(!1),ge(!1),alert(e),me(e),Oe()})),a.on("disconnected",(function(){console.log("peer id ".concat(a.id," disconnected")),Oe()})),a.on("connection",(function(e){ge(!0),L(e),console.log(":N:---\x3e> peer connection"),console.log(e),e.on("open",(function(){ge(!1);var t="".concat(a.id," is Joined");e.send({type:"chat",data:t,from:a.id})})),e.on("data",(function(t){if(ge(!1),void 0===H&&(q(t.from),V(t.from)),"disconnect"===t.type&&(console.log("".concat(H," is disconnected")),Oe()),"chat"===t.type)ne((function(e){return[{from:t.from,msg:t.data}].concat(Object(u.a)(e))})),Z(2);else if("file"===t.type){if(Z(3),console.log(t),t.filename){var n=new Blob([t.file],{type:t.data_type}),c=URL.createObjectURL(n);de((function(e){return[{name:t.filename,url:c,type:t.data_type}].concat(Object(u.a)(e))})),c&&e.send({type:"connect",success:!0})}}else"connect"===t.type&&t.success&&(console.log("success"),e.send({type:"connect",success:!0}))})),e.on("error",(function(e){ge(!1),me(e),console.log(e)}))})),a.on("call",(function(e){ge(!0),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia||navigator.mozGetUserMedia.getUserMedia,navigator.getUserMedia({video:{width:window.innerWidth/2,height:window.innerHeight/2},audio:!0},(function(t){ce.current.srcObject=t,e.answer(t),e.on("stream",(function(t){q(e.peer),ge(!1),pe.push(t);var n=pe.filter((function(e,t){return t===pe.findIndex((function(t){return t.id===e.id}))}));re(n),L(e)})),e.on("error",(function(e){ge(!1),me(e),t.getTracks().forEach((function(e){return e.stop()}))}))}),(function(e){ge(!1),console.error("Failed to get local stream",e)}))}))}),[a]);var pe=[],me=function(){var e=Object(l.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"unavailable-id"===t.type||"peer-unavailable"===t.type?(console.log(t),setInterval((function(){a.destroy()}),2345),a.disconnected&&window.location.reload()):console.error(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("reconnect"),window.location.reload();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(t){if(ge(!0),1===t)ge(!0),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia||navigator.mozGetUserMedia.getUserMedia,navigator.getUserMedia({video:{width:window.innerWidth/2,height:window.innerHeight/2},audio:!0},(function(t){var n=a.call(H+e,t);console.log(" caller => ",n,t),ce.current.srcObject=t,n.on("stream",(function(e){ge(!1),pe.push(e);var t=pe.filter((function(e,t){return t===pe.findIndex((function(t){return t.id===e.id}))}));re(t),L(n)})),n.on("error",(function(e){ge(!1),me(e),t.getTracks().forEach((function(e){return e.stop()})),t.getAudioTracks()[0].stop(),t.getVideoTracks()[0].stop()}))}),(function(e){console.log("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e1b\u0e34\u0e14\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e44\u0e14\u0e49"),console.log(e),ge(!1)}));else if(2===t){var n=a.connect(H+e);console.log("<<---:E: peer connection"),console.log(n),n.on("open",(function(){ge(!1);var e="".concat(a.id," is Joined");n.send({type:"chat",data:e,from:a.id})})),L(n),n.on("data",(function(e){if(ge(!1),void 0===H&&V(e.from),"chat"===e.type)ne((function(t){return[{from:e.from,msg:e.data}].concat(Object(u.a)(t))})),Z(2);else if("file"===e.type&&(Z(3),console.log(e),e.filename)){var t=new Blob([e.file],{type:e.type}),c=URL.createObjectURL(t);de((function(t){return[{name:e.filename,url:c,type:e.data_type}].concat(Object(u.a)(t))})),c&&n.send({type:"connect",success:!0})}"disconnect"===e.type&&(console.log("".concat(H," is disconnected")),ge(!1),Oe())})),n.on("error",(function(e){ge(!1),me(e)}))}else if(3===t){var c=a.connect(H+e);console.log("<<---:E: peer connection"),console.log(c),c.on("open",(function(){ge(!1);var e="".concat(a.id," is Joined");c.send({type:"file",data:e,from:a.id})})),L(c),c.on("data",(function(e){if(ge(!1),"file"===e.type&&(Z(3),console.log(e),e.filename)){var t=new Blob([e.file],{type:e.data_type}),n=URL.createObjectURL(t);de((function(t){return[{name:e.filename,url:n,type:e.data_type}].concat(Object(u.a)(t))})),n&&c.send({type:"connect",success:!0})}"disconnect"===e.type&&(console.log("".concat(H," is disconnected")),c.send({type:"disconnect",from:a.id}))})),c.on("error",(function(e){ge(!1),me(e)})),Z(3)}else ge(!1),console.warn("fail to connect")},xe=Object(c.useState)(""),ye=Object(d.a)(xe,2),ve=ye[0],we=ye[1],Ue=Object(c.useState)(),ke=Object(d.a)(Ue,2),Fe=ke[0],Se=ke[1],Me=Object(c.useState)(!0),Ce=Object(d.a)(Me,2),Ee=Ce[0],Ie=Ce[1];return Object(M.jsx)(M.Fragment,{children:a?Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(m.a,{maxWidth:"sm",children:Object(M.jsxs)(O.a,{children:[Object(M.jsx)(h.a,{display:"flex",children:U?Object(M.jsx)(x.a,{title:"\u0e01\u0e14\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e04\u0e31\u0e14\u0e25\u0e2d\u0e01",children:Object(M.jsxs)(w.a,{severity:"success",onClick:function(){try{navigator.clipboard.writeText(T)}catch(e){console.log("ERROR : \u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19\u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e04\u0e31\u0e14\u0e25\u0e2d\u0e01\u0e44\u0e14\u0e49 \n \u0e43\u0e2b\u0e49\u0e1c\u0e39\u0e49\u0e43\u0e0a\u0e49\u0e04\u0e25\u0e38\u0e21\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e04\u0e31\u0e14\u0e25\u0e2d\u0e01\u0e41\u0e17\u0e19 \n")}},children:["ID : ",T,"  ",U&&!D?Object(M.jsx)(p.a,{variant:"outlined",size:"small",onClick:function(){var t=prompt("\u0e01\u0e23\u0e2d\u0e01 ID \u0e40\u0e1b\u0e47\u0e19\u0e20\u0e32\u0e29\u0e32\u0e2d\u0e31\u0e07\u0e01\u0e24\u0e29");t&&t.length>0?(F(!1),i(),i(new S.a(t+e,{initiator:!0,trickle:!1,secure:!0,port:443,iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}]})),R(t)):alert("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48 ID")},children:"\u0e40\u0e1b\u0e25\u0e35\u0e48\u0e22\u0e19 ID"}):Object(M.jsx)(M.Fragment,{}),D?Object(M.jsx)(p.a,{variant:"outlined",color:"secondary",size:"small",display:"flex",justify:"space-between",style:{justifyContent:"flex"},onClick:function(){try{D.send({type:"disconnect",success:"bye"})}catch(e){}Oe()},children:"\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e23\u0e30\u0e1a\u0e1a"}):Object(M.jsx)(M.Fragment,{})]})}):Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(w.a,{severity:"warning",children:" \u0e01\u0e33\u0e25\u0e31\u0e07\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d  "}),Object(M.jsx)(y.a,{})]})}),D?Object(M.jsx)(M.Fragment,{}):Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("hr",{}),Object(M.jsxs)(v.a,{container:!0,xs:12,p:"2",children:[U?Object(M.jsx)(v.a,{xs:10,style:{margin:"1% auto"},children:Object(M.jsx)(g.a,{type:"text",label:"ID \u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e19 ",defaultValue:K,onChange:function(e){V(e.target.value),q(e.target.value)}})}):Object(M.jsx)(y.a,{}),Object(M.jsx)(v.a,{xs:3,style:{margin:"3% auto"},children:Object(M.jsx)(p.a,{variant:"contained",size:"small",onClick:function(){console.log("open camera"),he(1)},disabled:!H&&!K,children:"\u0e01\u0e25\u0e49\u0e2d\u0e07"})}),Object(M.jsx)(v.a,{xs:3,style:{margin:"3% auto"},children:Object(M.jsx)(p.a,{variant:"contained",size:"small",onClick:function(){return he(2)},disabled:!H&&!K,children:"\u0e41\u0e0a\u0e17"})}),Object(M.jsx)(v.a,{xs:3,style:{margin:"3% auto"},children:Object(M.jsx)(p.a,{variant:"contained",size:"small",onClick:function(){return he(3)},disabled:!H&&!K,children:"\u0e44\u0e1f\u0e25\u0e4c"})})]})]})]})}),ue.length>0?Object(M.jsx)(m.a,{theme:N,justify:"center",maxWidth:"sm",style:{marginTop:"2%"},children:Object(M.jsx)(f.a,{style:{maxHeight:200,overflow:"auto"},children:Object(M.jsx)(b.a,{children:ue&&ue.map((function(e,t){return Object(M.jsx)(B,{file:e},t)}))})})}):Object(M.jsx)(M.Fragment,{}),Object(M.jsx)(m.a,{theme:N,maxWidth:"sm",style:{marginTop:"2%"},children:2===Y?Object(M.jsx)(M.Fragment,{children:Object(M.jsxs)("div",{style:{margin:"16px auto"},children:[Object(M.jsx)(f.a,{style:{maxHeight:200,overflow:"auto"},children:Object(M.jsx)(b.a,{children:te.map((function(e,t){return Object(M.jsx)(J,{data:e,peer:a},t)}))})}),Object(M.jsx)(g.a,{type:"text",label:"\u0e43\u0e2a\u0e48\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21",style:{margin:"16px auto",width:"100%"},defaultValue:ve,onChange:function(e){return we(e.target.value)},onKeyDown:function(e){if("Enter"==e.key&&ve.length>0){var t=ve,n=a.id;try{D.send({type:"chat",data:t,from:n})}catch(e){ge(!1),console.warn(e.message),Oe()}ne((function(e){return[{from:n,msg:ve}].concat(Object(u.a)(e))})),e.target.value="",we("")}}})]})}):3===Y&&D?Object(M.jsx)(M.Fragment,{children:Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("input",{style:{marginTop:"3% auto"},type:"file",accept:"*",onChange:function(e){return function(e){var t=e.target.files[0];t.size<=5242880?(Se(t),Ie(!1)):alert("file \u0e15\u0e49\u0e2d\u0e07\u0e19\u0e49\u0e2d\u0e22\u0e01\u0e27\u0e48\u0e32 5MB")}(e)}}),Object(M.jsx)(p.a,{variant:"outlined",color:"primary",style:{margin:" auto"},disabled:Ee,onClick:function(){return function(){var e=new Blob([Fe],{type:Fe.type});D.send({type:"file",data_type:Fe.type,file:e,filename:Fe.name,from:a.id}),console.log("send ",Fe.name),Ie(!0)}()},children:"Upload"})]})}):Object(M.jsx)(M.Fragment,{})}),be?Object(M.jsx)(y.a,{style:{marginTop:"2%"}}):Object(M.jsx)(M.Fragment,{children:" "}),Object(M.jsxs)(m.a,{theme:N,justify:"center",maxWidth:"sm",style:{marginTop:"2%"},children:[D&&1===Y?Object(M.jsxs)(M.Fragment,{children:["Video \u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13 ",a.id]}):Object(M.jsx)(M.Fragment,{}),Object(M.jsx)("video",{ref:ce,style:{margin:"auto auto"},width:"100%",height:"50%",autoPlay:!0,muted:!0}),D&&1===Y?Object(M.jsxs)(M.Fragment,{children:[" ",Object(M.jsx)("hr",{style:{margin:"10px 2px"}})," Video \u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e19"]}):Object(M.jsx)(M.Fragment,{}),ie&&ie.map((function(e,t){return Object(M.jsx)(C,{stream:e},t)}))]})]}):Object(M.jsx)(M.Fragment,{})})},P=n(176),A=n(177),K=n(14),q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,364)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),c(e),o(e),a(e),i(e)}))},Q=Object(P.a)();console.table(Q);var X=function(){return Object(M.jsx)(V,{})};i.a.render(Object(M.jsx)(o.a.StrictMode,{children:Object(M.jsx)(A.a,{children:Object(M.jsxs)(K.c,{children:[Object(M.jsx)(K.a,{path:"/",exact:!0,component:X}),Object(M.jsx)(K.a,{path:"/611463023-p2p-react",exact:!0,component:X})]})})}),document.getElementById("root")),q()}},[[312,1,2]]]);
//# sourceMappingURL=main.a42d4a70.chunk.js.map